<!DOCTYPE html>
<html lang="lo">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BN Enterprise ERP 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0F2C59;
            --secondary: #3B82F6;
            --bg: #EFF6FF;
        }

        body {
            font-family: 'Noto Sans Lao', 'Sarabun', sans-serif;
            background: var(--bg);
            display: flex;
            color: #334155;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            height: 100%;
            background: white;
            border-right: 1px solid #E2E8F0;
            z-index: 100;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px;
            background: var(--primary);
            color: white;
        }

        .nav-item {
            padding: 12px 25px;
            color: #64748B;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: 0.2s;
            font-weight: 500;
            text-decoration: none;
        }

        .nav-item:hover,
        .nav-item.active {
            background: #DBEAFE;
            color: var(--secondary);
            border-right: 4px solid var(--secondary);
        }

        .section-label {
            font-size: 11px;
            color: #94A3B8;
            padding: 20px 25px 5px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .main {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            position: relative;
        }

        .card-custom {
            background: white;
            border-radius: 12px;
            border: 1px solid #E2E8F0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03);
        }

        .section-pane {
            display: none;
            height: 100%;
            animation: fadeIn 0.3s;
        }

        .section-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Upload Styles */
        .upload-container {
            position: relative;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .upload-box {
            width: 140px;
            height: 140px;
            border-radius: 24px;
            background: #F8FAFC;
            border: 2px dashed #CBD5E1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .upload-box:hover {
            border-color: var(--secondary);
            background: #EFF6FF;
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.15);
        }

        .upload-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .upload-placeholder {
            text-align: center;
            color: #94A3B8;
            transition: 0.3s;
        }

        .upload-box:hover .upload-placeholder {
            color: var(--secondary);
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .upload-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: 0.2s;
        }

        .upload-box:hover+.upload-badge {
            transform: scale(1.1);
            background: var(--secondary);
        }

        /* Loading Overlay */
        #globalLoading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* POS & Print Styles */
        .product-card {
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid #eee;
        }

        .product-card:hover {
            border-color: var(--secondary);
        }

        @media print {
            body {
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .sidebar,
            .login-overlay,
            .modal,
            .btn,
            .upload-badge {
                display: none !important;
            }

            .main {
                padding: 0 !important;
            }

            .card-custom {
                border: none !important;
                box-shadow: none !important;
            }

            #assets::before {
                content: "Asset Report";
                font-size: 24px;
                font-weight: bold;
                display: block;
                margin-bottom: 20px;
            }
        }

        /* Login Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .login-enter {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .shake {
            animation: shake 0.3s ease-in-out;
        }
    </style>
</head>

<body class="bg-light">

    <!-- GLOBAL LOADING -->
    <div id="globalLoading" class="d-none">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <div class="mt-2 fw-bold text-primary">Syncing with Cloud...</div>
    </div>

    <!-- LOGIN OVERLAY -->
    <div id="loginOverlay"
        class="position-fixed top-0 start-0 w-100 h-100 bg-white d-flex justify-content-center align-items-center"
        style="z-index: 2000; transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1;">
        <div id="loginCard" class="login-container p-5 bg-white shadow-lg text-center border-0 login-enter"
            style="max-width: 400px; width: 90%; border-radius: 24px; transition: transform 0.3s;">
            <div class="mb-4">
                <div class="bg-primary bg-opacity-10 p-3 rounded-circle d-inline-block mb-3">
                    <i class="fas fa-cube fa-3x text-primary"></i>
                </div>
                <h3 class="fw-bold text-dark m-0">BN Enterprise</h3>
                <p class="text-muted small">‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫Ñ‡∫∏‡ªâ‡∫°‡∫Ñ‡∫≠‡∫á‡∫ó‡∫∏‡∫•‡∫∞‡∫Å‡∫¥‡∫î 2026</p>
            </div>
            <div class="form-floating mb-3 text-start">
                <input type="text" class="form-control border-light bg-light" id="loginUser" placeholder="Username"
                    onkeyup="if(event.key==='Enter') attemptLogin()">
                <label><i class="fas fa-user me-2 text-muted"></i>‡∫ä‡∫∑‡ªà‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ (Username)</label>
            </div>
            <div class="form-floating mb-3 text-start">
                <input type="password" class="form-control border-light bg-light" id="loginPass" placeholder="Password"
                    onkeyup="if(event.key==='Enter') attemptLogin()">
                <label><i class="fas fa-lock me-2 text-muted"></i>‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô (Password)</label>
            </div>
            <button id="loginBtn" class="btn btn-primary w-100 py-3 fw-bold shadow-sm rounded-4"
                onclick="attemptLogin()">
                <span id="loginBtnText">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö (Login)</span>
                <div id="loginLoading" class="spinner-border spinner-border-sm text-white d-none"></div>
            </button>
            <p id="loginError" class="text-danger small mt-3 fw-bold" style="display: none;"></p>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header text-center">
            <div class="mb-2">
                <div class="bg-white text-primary rounded-circle d-inline-flex justify-content-center align-items-center shadow-sm"
                    style="width: 50px; height: 50px;">
                    <i class="fas fa-cube fa-lg"></i>
                </div>
            </div>
            <h5 class="m-0 fw-bold">BN ERP 2026</h5>
            <small style="opacity: 0.8; font-size: 0.75rem;">Enterprise Edition</small>
            <div
                class="mt-4 p-3 bg-white bg-opacity-10 rounded text-start d-flex align-items-center border border-white border-opacity-25">
                <i class="fas fa-user-circle fa-2x me-3"></i>
                <div class="lh-sm">
                    <div class="fw-bold small" id="userDisplay">Guest</div>
                    <small style="font-size: 0.7rem; opacity: 0.8;" id="roleDisplay">Please Login</small>
                </div>
            </div>
        </div>
        <div class="section-label">Operations</div>
        <div class="nav-item active" onclick="nav('dashboard', this)"><i
                class="fas fa-tachometer-alt me-2"></i>Dashboard</div>
        <div class="nav-item" onclick="nav('sales', this)"><i class="fas fa-cash-register me-2"></i> POS Terminal</div>
        <div class="nav-item" onclick="nav('assets', this)"><i class="fas fa-boxes me-2"></i> Asset Governance</div>
        <div class="nav-item" onclick="nav('manual', this)"><i class="fas fa-book me-2"></i> ‡∫Ñ‡∫π‡ªà‡∫°‡∫∑‡∫Å‡∫≤‡∫ô‡∫ô‡∫≥‡ªÉ‡∫ä‡ªâ</div>
        <div class="mt-auto p-3">
            <button class="btn btn-danger w-100 btn-sm" onclick="logout()"><i
                    class="fas fa-sign-out-alt me-2"></i>Logout</button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main">
        <!-- DASHBOARD -->
        <div id="dashboard" class="section-pane active">
            <h3 class="mb-4 fw-bold text-dark">Executive Overview</h3>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card-custom p-4 h-100" onclick="nav('sales', document.querySelectorAll('.nav-item')[1])"
                        style="cursor: pointer; border-left: 5px solid #3B82F6;">
                        <h5 class="fw-bold"><i class="fas fa-cash-register text-primary me-2"></i>POS Terminal</h5>
                        <h3 class="fw-bold text-primary mt-3" id="dashRev">‡∏ø0.00</h3>
                        <small class="text-success">Today's Sales</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-custom p-4 h-100"
                        onclick="nav('assets', document.querySelectorAll('.nav-item')[2])"
                        style="cursor: pointer; border-left: 5px solid #10B981;">
                        <h5 class="fw-bold"><i class="fas fa-boxes text-success me-2"></i>Asset Governance</h5>
                        <h3 class="fw-bold text-success mt-3" id="dashAssetCount">0 Items</h3>
                        <small class="text-muted">Total Registered</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- POS TERMINAL -->
        <div id="sales" class="section-pane">
            <div class="row h-100">
                <div class="col-8 h-100">
                    <input type="text" class="form-control mb-3" placeholder="Search Products..."
                        onkeyup="filterPos(this.value)">
                    <div class="row g-3" id="posGrid"></div>
                </div>
                <div class="col-4 h-100 d-flex flex-column">
                    <div class="card-custom p-3 flex-grow-1 d-flex flex-column">
                        <h5 class="fw-bold"><i class="fas fa-shopping-cart me-2"></i>Current Order</h5>
                        <div id="cartItems" class="flex-grow-1 overflow-auto my-3"></div>
                        <div class="border-top pt-3">
                            <div class="d-flex justify-content-between h4 fw-bold"><span>Total:</span><span
                                    class="text-primary" id="cartTotal">0.00</span></div>
                            <button class="btn btn-primary w-100 py-3 mt-2 fw-bold"
                                onclick="checkout()">CHECKOUT</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- USER MANUAL -->
        </div>
        <div id="manual" class="section-pane">
            <h3 class="mb-4 fw-bold text-primary"><i class="fas fa-book me-2"></i>‡∫Ñ‡∫π‡ªà‡∫°‡∫∑‡∫Å‡∫≤‡∫ô‡∫ô‡∫≥‡ªÉ‡∫ä‡ªâ (User Manual)</h3>
            <div class="accordion shadow-sm" id="accordionManual">
                <!-- 1. Login -->
                <div class="accordion-item border-0 mb-3 rounded-4 overflow-hidden">
                    <h2 class="accordion-header">
                        <button class="accordion-button fw-bold bg-white" type="button" data-bs-toggle="collapse"
                            data-bs-target="#man1">
                            <span class="badge bg-primary me-2">1</span> ‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö (Login)
                        </button>
                    </h2>
                    <div id="man1" class="accordion-collapse collapse show" data-bs-parent="#accordionManual">
                        <div class="accordion-body bg-light">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>‡ªÉ‡∫™‡ªà
                                    <strong>‡∫ä‡∫∑‡ªà‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ (Username)</strong> ‡ªÅ‡∫•‡∫∞ <strong>‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô (Password)</strong>.
                                </li>
                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫°
                                    <strong>"‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö (Login)"</strong>.
                                </li>
                                <li class="mb-2"><i class="fas fa-info-circle text-info me-2"></i><em>Default
                                        Account: admin / admin</em></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 2. Dashboard -->
                <div class="accordion-item border-0 mb-3 rounded-4 overflow-hidden">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed fw-bold bg-white" type="button"
                            data-bs-toggle="collapse" data-bs-target="#man2">
                            <span class="badge bg-primary me-2">2</span> ‡ªú‡ªâ‡∫≤ Dashboard (‡∫û‡∫≤‡∫ö‡∫•‡∫ß‡∫°)
                        </button>
                    </h2>
                    <div id="man2" class="accordion-collapse collapse" data-bs-parent="#accordionManual">
                        <div class="accordion-body bg-light">
                            <p>‡ªú‡ªâ‡∫≤‡∫ô‡∫µ‡ªâ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫û‡∫≤‡∫ö‡∫•‡∫ß‡∫°‡∫Ç‡∫≠‡∫á‡∫•‡∫∞‡∫ö‡∫ª‡∫ö:</p>
                            <ul>
                                <li><strong>POS Terminal:</strong> ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç‡∫•‡∫ß‡∫°‡∫Ç‡∫≠‡∫á‡∫°‡∫∑‡ªâ‡∫ô‡∫µ‡ªâ.</li>
                                <li><strong>Asset Governance:</strong> ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫ó‡∫µ‡ªà‡ªÑ‡∫î‡ªâ‡∫•‡∫ª‡∫á‡∫ó‡∫∞‡∫ö‡∫Ω‡∫ô‡ªÑ‡∫ß‡ªâ.</li>
                                <li>‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫Å‡∫ª‡∫î‡∫ó‡∫µ‡ªà‡∫Å‡ªà‡∫≠‡∫á (Card) ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡ªÑ‡∫õ‡∫ç‡∫±‡∫á‡ªú‡ªâ‡∫≤‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å‡∫ô‡∫±‡ªâ‡∫ô‡ªÜ‡ªÑ‡∫î‡ªâ‡∫ó‡∫±‡∫ô‡∫ó‡∫µ.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 3. POS -->
                <div class="accordion-item border-0 mb-3 rounded-4 overflow-hidden">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed fw-bold bg-white" type="button"
                            data-bs-toggle="collapse" data-bs-target="#man3">
                            <span class="badge bg-primary me-2">3</span> ‡∫Å‡∫≤‡∫ô‡∫Ç‡∫≤‡∫ç POS (Point of Sale)
                        </button>
                    </h2>
                    <div id="man3" class="accordion-collapse collapse" data-bs-parent="#accordionManual">
                        <div class="accordion-body bg-light">
                            <ol>
                                <li class="mb-2"><strong>‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤:</strong> ‡∫û‡∫¥‡∫°‡∫ä‡∫∑‡ªà‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡ªÉ‡∫ô‡∫ä‡ªà‡∫≠‡∫á‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤‡∫î‡ªâ‡∫≤‡∫ô‡ªÄ‡∫ó‡∫¥‡∫á.
                                </li>
                                <li class="mb-2"><strong>‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤:</strong> ‡∫Å‡∫ª‡∫î‡∫ó‡∫µ‡ªà‡∫Å‡ªà‡∫≠‡∫á‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤
                                    ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫•‡∫ª‡∫á‡ªÉ‡∫ô‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫™‡∫±‡ªà‡∫á‡∫ä‡∫∑‡ªâ (‡∫Ç‡∫ß‡∫≤‡∫°‡∫∑).</li>
                                <li class="mb-2"><strong>‡∫ä‡∫≥‡∫•‡∫∞‡ªÄ‡∫á‡∫¥‡∫ô:</strong> ‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫° <strong>"CHECKOUT"</strong>
                                    ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤‡∫ä‡∫≥‡∫•‡∫∞‡ªÄ‡∫á‡∫¥‡∫ô‡∫Æ‡∫Ω‡∫ö‡∫Æ‡ªâ‡∫≠‡∫ç‡ªÅ‡∫•‡ªâ‡∫ß.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 4. Assets -->
                <div class="accordion-item border-0 mb-3 rounded-4 overflow-hidden">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed fw-bold bg-white" type="button"
                            data-bs-toggle="collapse" data-bs-target="#man4">
                            <span class="badge bg-primary me-2">4</span> ‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô (Asset Governance)
                        </button>
                    </h2>
                    <div id="man4" class="accordion-collapse collapse" data-bs-parent="#accordionManual">
                        <div class="accordion-body bg-light">
                            <ul>
                                <li class="mb-2"><strong>‡∫Å‡∫≤‡∫ô‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô‡ªÉ‡ªù‡ªà:</strong> ‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫° <span
                                        class="badge bg-primary"><i class="fas fa-plus"></i> New Asset</span>
                                    ‡ªÅ‡∫•‡ªâ‡∫ß‡∫ï‡∫∑‡ªà‡∫°‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô, ‡∫≠‡∫±‡∫ö‡ªÇ‡∫´‡∫º‡∫î‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö ‡ªÅ‡∫•‡∫∞ ‡∫Å‡∫ª‡∫î Save Asset.</li>
                                <li class="mb-2"><strong>‡∫Å‡∫≤‡∫ô‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç:</strong> ‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫° <span
                                        class="badge bg-light text-dark border"><i
                                            class="fas fa-wrench text-warning"></i></span>
                                    ‡∫´‡∫º‡∫±‡∫á‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫ó‡∫µ‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç.</li>
                                <li class="mb-2"><strong>‡∫Å‡∫≤‡∫ô‡∫•‡∫ª‡∫ö:</strong> ‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫° <span
                                        class="badge bg-light text-dark border"><i
                                            class="fas fa-trash text-danger"></i></span> (‡∫™‡∫∞‡ªÄ‡∫û‡∫≤‡∫∞ Admin ‡ªÄ‡∫ó‡∫ª‡ªà‡∫≤‡∫ô‡∫±‡ªâ‡∫ô).
                                </li>
                                <li class="mb-2"><strong>‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤:</strong> ‡∫û‡∫¥‡∫°‡∫•‡∫∞‡∫´‡∫±‡∫î, ‡∫ä‡∫∑‡ªà, ‡∫´‡∫º‡∫∑ ‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞ ‡ªÉ‡∫ô‡∫ä‡ªà‡∫≠‡∫á Search
                                    ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤‡∫ó‡∫±‡∫ô‡∫ó‡∫µ.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASSET GOVERNANCE -->
        <div id="assets" class="section-pane">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold text-primary"><i class="fas fa-boxes me-2"></i>‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫Ñ‡∫∏‡ªâ‡∫°‡∫Ñ‡∫≠‡∫á‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô</h3>
                <div>
                    <button class="btn btn-outline-info me-2 fw-bold" onclick="printReport()"><i
                            class="fas fa-print me-2"></i>Report</button>
                    <button class="btn btn-primary fw-bold" data-bs-toggle="modal" data-bs-target="#addAssetModal"><i
                            class="fas fa-plus me-2"></i>New Asset</button>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card-custom p-3 border-start border-4 border-info"><small
                            class="text-muted fw-bold">‡∫°‡∫π‡∫ô‡∫Ñ‡ªà‡∫≤‡∫•‡∫ß‡∫°</small>
                        <h4 class="mb-0 text-info fw-bold" id="assetTotalVal">0</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card-custom p-3 border-start border-4 border-success"><small
                            class="text-muted fw-bold">‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô‡∫¢‡∫π‡ªà</small>
                        <h4 class="mb-0 text-success fw-bold" id="assetActiveCount">0</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card-custom p-3 border-start border-4 border-warning"><small
                            class="text-muted fw-bold">‡∫™‡∫ª‡ªà‡∫á‡∫ä‡ªâ‡∫≠‡∫°</small>
                        <h4 class="mb-0 text-warning fw-bold" id="assetRepairCount">0</h4>
                    </div>
                </div>
            </div>

            <div class="card-custom p-0 overflow-hidden shadow-sm">
                <div class="p-3 bg-light border-bottom">
                    <div class="row g-2 align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-0 fw-bold">Asset Registry</h6>
                        </div>
                        <div class="col-md-4"><input type="text" class="form-control form-control-sm"
                                onkeyup="searchAssets(this.value)" placeholder="üîç Search..."></div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary bg-white"
                                    onclick="filterAsset('all')">All</button>
                                <button class="btn btn-outline-secondary bg-white"
                                    onclick="filterAsset('Fixed')">Fixed</button>
                                <button class="btn btn-outline-secondary bg-white"
                                    onclick="filterAsset('Tool')">Tool</button>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table table-hover align-middle mb-0 text-nowrap">
                    <thead class="table-light small text-muted">
                        <tr>
                            <th style="width: 50px;">Img</th>
                            <th>Code</th>
                            <th>S/N</th>
                            <th>Branch</th>
                            <th>Name</th>
                            <th>Holder</th>
                            <th>Value</th>
                            <th>Status</th>
                            <th>Note</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="assetTable"></tbody>
                </table>
            </div>
        </div>

        <!-- ADD ASSET MODAL (Updated UI) -->
        <div class="modal fade" id="addAssetModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 24px;">
                    <div class="modal-header bg-gradient bg-primary text-white border-0 p-4">
                        <div>
                            <h5 class="modal-title fw-bold m-0"><i class="fas fa-plus-circle me-2"></i>‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô‡ªÉ‡ªù‡ªà
                                (New Asset)
                            </h5>
                        </div>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4 bg-light">
                        <!-- Premium Upload UI -->
                        <div class="text-center mb-4">
                            <div class="upload-container">
                                <div class="upload-box shadow-sm"
                                    onclick="document.getElementById('newAssetImage').click()">
                                    <img id="newAssetPreview" src="" class="d-none">
                                    <div id="newAssetPlaceholder" class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                        <div
                                            style="font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
                                            Upload Photo</div>
                                    </div>
                                </div>
                                <div class="upload-badge"><i class="fas fa-camera"></i></div>
                            </div>
                            <input type="file" id="newAssetImage" class="d-none" accept="image/*"
                                onchange="previewImage(this, 'newAssetPreview', 'newAssetPlaceholder')">
                        </div>

                        <!-- Card 1: Basic Info -->
                        <div class="card border-0 mb-3 shadow-sm rounded-4">
                            <div class="card-body p-3">
                                <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1"><i
                                        class="fas fa-info-circle me-2"></i>‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫û‡∫∑‡ªâ‡∫ô‡∫ñ‡∫≤‡∫ô (Basic Info)</h6>
                                <div class="row g-3">
                                    <div class="col-6">
                                        <label class="small fw-bold text-muted">‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô (Asset Code) <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control fw-bold" id="newAssetCode"
                                            value="AST-00X" required oninput="this.classList.remove('is-invalid')">
                                    </div>
                                    <div class="col-6">
                                        <label class="small fw-bold text-muted">‡ªÄ‡∫•‡∫Å‡∫ä‡∫µ‡∫£‡∫Ω‡∫ß (Serial No.)</label>
                                        <input type="text" class="form-control" id="newAssetSerial"
                                            placeholder="‡∫•‡∫∞‡∫ö‡∫∏ S/N...">
                                    </div>
                                    <div class="col-12">
                                        <label class="small fw-bold text-muted">‡∫ä‡∫∑‡ªà‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô (Asset Name) <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control fw-bold" id="newAssetName"
                                            placeholder="‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á: MacBook Pro M3" required
                                            oninput="this.classList.remove('is-invalid')">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Details -->
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="card border-0 shadow-sm h-100 rounded-4">
                                    <div class="card-body p-3">
                                        <label class="small fw-bold text-muted">‡∫õ‡∫∞‡ªÄ‡∫û‡∫î (Type)</label>
                                        <select class="form-select mb-2" id="newAssetType">
                                            <option value="Fixed">‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô‡∫Ñ‡∫ª‡∫á‡∫ó‡∫µ‡ªà (Fixed Asset)</option>
                                            <option value="Consumable">‡∫ß‡∫±‡∫î‡∫ñ‡∫∏‡∫™‡∫¥‡ªâ‡∫ô‡ªÄ‡∫õ‡∫∑‡∫≠‡∫á (Consumable)</option>
                                            <option value="Tool">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫°‡∫∑ (Tool/Equipment)</option>
                                            <option value="Vehicle">‡∫ç‡∫≤‡∫ô‡∫û‡∫≤‡∫´‡∫∞‡∫ô‡∫∞ (Vehicle)</option>
                                        </select>
                                        <label class="small fw-bold text-muted">‡∫°‡∫π‡∫ô‡∫Ñ‡ªà‡∫≤ (LAK)</label>
                                        <input type="number" class="form-control text-end fw-bold text-success"
                                            id="newAssetValue" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card border-0 shadow-sm h-100 rounded-4">
                                    <div class="card-body p-3">
                                        <label class="small fw-bold text-muted">‡∫ú‡∫π‡ªâ‡∫™‡∫∞‡ªú‡∫≠‡∫á (Vendor)</label>
                                        <input type="text" class="form-control mb-2" id="newAssetVendor"
                                            placeholder="‡∫ä‡∫∑‡ªâ‡∫à‡∫≤‡∫Å‡∫Æ‡ªâ‡∫≤‡∫ô...">
                                        <label class="small fw-bold text-muted">‡ªù‡∫ß‡∫î‡ªù‡∫π‡ªà (Folder)</label>
                                        <input type="text" class="form-control" id="newAssetFolder"
                                            placeholder="‡ªÄ‡∫ä‡∫±‡ªà‡∫ô: IT, Office, Kitchen">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Lifecycle -->
                        <div class="card border-0 shadow-sm mt-3 rounded-4">
                            <div class="card-body p-3">
                                <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1"><i
                                        class="fas fa-calendar-alt me-2"></i>‡∫ß‡∫ª‡∫á‡∫à‡∫≠‡∫ô‡∫ä‡∫µ‡∫ß‡∫¥‡∫î & ‡∫ó‡∫µ‡ªà‡∫¢‡∫π‡ªà (Lifecycle)</h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="small fw-bold text-muted">‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡∫ä‡∫∑‡ªâ (Purchase Date)</label>
                                        <input type="date" class="form-control small" id="newAssetPurchaseDate">
                                    </div>
                                    <div class="col-6">
                                        <label class="small fw-bold text-muted">‡∫ß‡∫±‡∫ô‡ªù‡∫ª‡∫î‡∫õ‡∫∞‡∫Å‡∫±‡∫ô (Warranty)</label>
                                        <input type="date" class="form-control small" id="newAssetWarrantyDate">
                                    </div>
                                </div>
                                <div class="row g-2">
                                    <div class="col-5">
                                        <label class="small fw-bold text-muted">‡∫™‡∫≤‡∫Ç‡∫≤ (Branch) <span
                                                class="text-danger">*</span></label>
                                        <select class="form-select" id="newAssetBranch" required
                                            onchange="this.classList.remove('is-invalid')">
                                            <option value="" disabled selected>‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å...</option>
                                            <option value="HQ">HQ</option>
                                            <option value="VTE">VTE</option>
                                            <option value="LPB">LPB</option>
                                            <option value="SVK">SVK</option>
                                            <option value="PAK">PAK</option>
                                            <option value="KHM">KHM</option>
                                            <option value="BKO">BKO</option>
                                            <option value="XAY">XAY</option>
                                            <option value="XIENG">XIENG</option>
                                            <option value="OTHER">Other</option>
                                        </select>
                                    </div>
                                    <div class="col-7">
                                        <label class="small fw-bold text-muted">‡∫ú‡∫π‡ªâ‡∫ñ‡∫∑‡∫Ñ‡∫≠‡∫á (Holder)</label>
                                        <input type="text" class="form-control" id="newAssetHolder"
                                            placeholder="‡∫ä‡∫∑‡ªà‡∫ú‡∫π‡ªâ‡∫Æ‡∫±‡∫ö‡∫ú‡∫¥‡∫î‡∫ä‡∫≠‡∫ö...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 bg-light p-3">
                        <button class="btn btn-light fw-bold" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary px-4 fw-bold rounded-pill" onclick="saveNewAsset()">Save
                            Asset</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- EDIT ASSET MODAL -->
        <div class="modal fade" id="editAssetModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 24px;">
                    <div class="modal-header bg-warning text-dark border-0 p-4">
                        <div>
                            <h5 class="modal-title fw-bold m-0"><i class="fas fa-wrench me-2"></i>Edit Asset</h5>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4 bg-light">
                        <input type="hidden" id="editAssetCodeHidden">

                        <!-- Upload -->
                        <div class="text-center mb-4">
                            <div class="upload-container">
                                <div class="upload-box shadow-sm"
                                    onclick="document.getElementById('editAssetImage').click()">
                                    <img id="editAssetPreview" src="" class="d-none">
                                    <div id="editAssetPlaceholder" class="upload-placeholder">
                                        <i class="fas fa-camera upload-icon"></i>
                                        <div style="font-size: 0.70rem; fw-bold">CHANGE</div>
                                    </div>
                                </div>
                                <div class="upload-badge bg-warning text-dark border-dark"><i
                                        class="fas fa-pencil-alt"></i></div>
                            </div>
                            <input type="file" id="editAssetImage" class="d-none" accept="image/*"
                                onchange="previewImage(this, 'editAssetPreview', 'editAssetPlaceholder')">
                        </div>

                        <!-- Card 1: Details -->
                        <div class="card border-0 mb-3 shadow-sm rounded-4">
                            <div class="card-body p-3">
                                <label class="small fw-bold text-muted">‡∫ä‡∫∑‡ªà‡∫ä‡∫±‡∫ö‡∫™‡∫¥‡∫ô (Asset Name)</label>
                                <input type="text" class="form-control fw-bold mb-3" id="editAssetName">
                                <div class="row g-2 mb-2">
                                    <div class="col-6"><label class="small text-muted fw-bold">‡ªÄ‡∫•‡∫Å‡∫ä‡∫µ‡∫£‡∫Ω‡∫ß
                                            (S/N)</label><input type="text" class="form-control" id="editAssetSerial">
                                    </div>
                                    <div class="col-6"><label class="small text-muted fw-bold">‡∫ú‡∫π‡ªâ‡∫™‡∫∞‡ªú‡∫≠‡∫á
                                            (Vendor)</label><input type="text" class="form-control"
                                            id="editAssetVendor"></div>
                                </div>
                                <div class="row g-2">
                                    <div class="col-6"><label class="small text-muted fw-bold">‡ªù‡∫ß‡∫î‡ªù‡∫π‡ªà
                                            (Folder)</label><input type="text" class="form-control"
                                            id="editAssetFolder"></div>
                                    <div class="col-6"><label class="small text-muted fw-bold">‡∫ú‡∫π‡ªâ‡∫ñ‡∫∑‡∫Ñ‡∫≠‡∫á
                                            (Holder)</label><input type="text" class="form-control"
                                            id="editAssetHolder"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Dates -->
                        <div class="card border-0 mb-3 shadow-sm rounded-4">
                            <div class="card-body p-3">
                                <div class="row g-2">
                                    <div class="col-6"><label class="small text-muted fw-bold">‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡∫ä‡∫∑‡ªâ
                                            (Purchase)</label><input type="date" class="form-control small"
                                            id="editAssetPurchaseDate"></div>
                                    <div class="col-6"><label class="small text-muted fw-bold">‡∫ß‡∫±‡∫ô‡ªù‡∫ª‡∫î‡∫õ‡∫∞‡∫Å‡∫±‡∫ô
                                            (Warranty)</label><input type="date" class="form-control small"
                                            id="editAssetWarrantyDate"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Status -->
                        <div class="card border-0 shadow-sm rounded-4 border-start border-4 border-warning">
                            <div class="card-body p-3">
                                <label class="small fw-bold text-muted">‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞ (Status)</label>
                                <select class="form-select mb-2" id="editAssetStatus" onchange="toggleRepairNote()">
                                    <option value="Active">‡∫û‡ªâ‡∫≠‡∫°‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô (Active)</option>
                                    <option value="Repair">‡∫™‡∫ª‡ªà‡∫á‡∫ä‡ªâ‡∫≠‡∫° (Repair)</option>
                                    <option value="In Use">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô (In Use)</option>
                                </select>
                                <div class="collapse" id="repairNoteDiv">
                                    <textarea class="form-control border-danger bg-danger bg-opacity-10"
                                        id="editAssetNote" rows="2"
                                        placeholder="‡∫•‡∫∞‡∫ö‡∫∏‡∫≠‡∫≤‡∫Å‡∫≤‡∫ô‡ªÄ‡∫™‡∫ç/‡∫•‡∫≤‡∫ç‡∫•‡∫∞‡∫≠‡∫Ω‡∫î‡∫Å‡∫≤‡∫ô‡∫ä‡ªâ‡∫≠‡∫°..."></textarea>
                                </div>
                                <div class="mt-2">
                                    <label class="small fw-bold text-muted">‡∫™‡∫≤‡∫Ç‡∫≤ (Branch)</label>
                                    <select class="form-select" id="editAssetBranch">
                                        <option value="HQ">HQ</option>
                                        <option value="VTE">VTE</option>
                                        <option value="LPB">LPB</option>
                                        <option value="SVK">SVK</option>
                                        <option value="PAK">PAK</option>
                                        <option value="KHM">KHM</option>
                                        <option value="BKO">BKO</option>
                                        <option value="XAY">XAY</option>
                                        <option value="XIENG">XIENG</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 bg-light p-3">
                        <button class="btn btn-light fw-bold" data-bs-dismiss="modal">‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å (Cancel)</button>
                        <button class="btn btn-warning px-4 fw-bold rounded-pill" onclick="saveEditAsset()">‡∫õ‡∫±‡∫ö‡∫õ‡∫∏‡∫á
                            (Update)</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- APP STATE ---
        let currentUser = { name: null, role: null };
        let assetData = [];
        let assetFiltered = [];
        let cart = [];
        const promoData = [
            { code: "P1", shortname: "Notebook Asus", cost: 13200, icon: "fa-laptop" },
            { code: "P2", shortname: "Canon Printer", cost: 4500, icon: "fa-print" }
        ];
        let posFiltered = promoData;
        let userData = [{ id: 1, u: 'admin', p: 'admin', name: 'Super Admin', role: 'admin' }];

        // --- IMAGE HELPER ---
        function previewImage(input, imgId, phId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById(imgId);
                    const ph = document.getElementById(phId);
                    img.src = e.target.result;
                    img.classList.remove('d-none');
                    if (ph) ph.classList.add('d-none');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function compressImage(file, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 600;
                    const scaleSize = MAX_WIDTH / img.width;
                    const w = (img.width > MAX_WIDTH) ? MAX_WIDTH : img.width;
                    const h = (img.width > MAX_WIDTH) ? (img.height * scaleSize) : img.height;
                    canvas.width = w; canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.6));
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderPosGrid();
            if (typeof google === 'undefined') loadFromLocalBackup();
        });

        // --- CORE FUNCTIONS ---
        function showLoading() { document.getElementById('globalLoading').classList.remove('d-none'); }
        function hideLoading() { document.getElementById('globalLoading').classList.add('d-none'); }

        // --- ACTIVITY LOGGING (New Module) ---
        function logDbActivity(module, action, details, val = 0) {
            if (typeof google === 'undefined' || !google.script) return; // Offline mode ignore

            // Fire and forget - don't wait for success
            google.script.run.recordActivity({
                module: module,
                user: currentUser ? currentUser.name : 'Guest',
                action: action,
                details: details,
                refCode: '-',
                value: val
            });
        }

        function attemptLogin() {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            const card = document.getElementById('loginCard');

            // Reset UI
            err.style.display = 'none';
            card.classList.remove('shake');

            if (!u || !p) {
                err.innerText = '‚ö†Ô∏è Please enter username and password';
                err.style.display = 'block';
                void card.offsetWidth; // Trigger reflow
                card.classList.add('shake');
                return;
            }

            const user = userData.find(x => x.u === u && x.p === p);

            if (user) {
                currentUser = user;
                document.getElementById('userDisplay').innerText = user.name;
                document.getElementById('roleDisplay').innerText = user.role.toUpperCase();

                // Track Login
                try { logDbActivity('AUTH', 'LOGIN', `User ${user.u} logged in successfully`, 0); } catch (e) { }

                // Smooth Transition
                const overlay = document.getElementById('loginOverlay');
                overlay.style.opacity = '0';
                overlay.style.pointerEvents = 'none';

                // Scale effect on card for extra smoothness
                card.style.transform = 'scale(1.1)';

                setTimeout(() => {
                    overlay.style.display = 'none';
                    loginSuccess();
                }, 600);
            } else {
                err.innerText = '‚ùå Incorrect Username or Password';
                err.style.display = 'block';
                void card.offsetWidth; // Trigger reflow
                card.classList.add('shake');
            }
        }

        function loginSuccess() {
            showLoading();
            if (typeof google !== 'undefined' && google.script) {
                google.script.run.withSuccessHandler(d => {
                    hideLoading(); assetData = d ? (typeof d === 'string' ? JSON.parse(d) : d) : []; assetFiltered = assetData; renderAssets(); saveToLocalBackup();
                }).withFailureHandler(() => { hideLoading(); loadFromLocalBackup(); }).getAssets();
            } else { hideLoading(); loadFromLocalBackup(); }
        }

        function logout() {
            logDbActivity('AUTH', 'LOGOUT', `User ${currentUser.name} logged out`);
            location.reload();
        }

        function nav(id, el) {
            document.querySelectorAll('.section-pane').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (el) { document.querySelectorAll('.nav-item').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
        }

        // --- POS ---
        function filterPos(t) { posFiltered = promoData.filter(i => i.shortname.toLowerCase().includes(t.toLowerCase())); renderPosGrid(); }
        function renderPosGrid() { document.getElementById('posGrid').innerHTML = posFiltered.map(i => `<div class="col-4"><div class="card product-card p-3 text-center h-100" onclick="addToCart('${i.code}')"><i class="fas ${i.icon} fa-2x mb-2 text-secondary"></i><h6 class="fw-bold mb-0 small">${i.shortname}</h6></div></div>`).join(''); }
        function addToCart(c) { const x = cart.find(i => i.code === c); if (x) x.qty++; else cart.push({ ...promoData.find(i => i.code === c), qty: 1 }); renderCart(); }
        function renderCart() {
            document.getElementById('cartItems').innerHTML = cart.map(i => `<div class="d-flex justify-content-between border-bottom p-2 small"><div>${i.shortname} x${i.qty}</div><div class="fw-bold">${(i.cost * i.qty).toLocaleString()}</div></div>`).join('');
            document.getElementById('cartTotal').innerText = cart.reduce((s, i) => s + (i.cost * i.qty), 0).toLocaleString();
        }
        function checkout() {
            if (cart.length) {
                const total = cart.reduce((s, i) => s + (i.cost * i.qty), 0);

                // Track Sale
                logDbActivity('POS', 'SALE', `Sold ${cart.length} items. Ref: ${new Date().getTime()}`, total);

                alert('‚úÖ Paid: ' + total.toLocaleString());
                cart = [];
                renderCart();
            }
        }

        // --- ASSETS ---
        function renderAssets() {
            document.getElementById('assetTotalVal').innerText = '‡∏ø' + assetData.reduce((s, a) => s + (parseFloat(a.value) || 0), 0).toLocaleString();
            document.getElementById('assetActiveCount').innerText = assetData.filter(a => ['Active', 'In Use'].includes(a.status)).length;
            document.getElementById('assetRepairCount').innerText = assetData.filter(a => a.status === 'Repair').length;
            if (document.getElementById('dashAssetCount')) document.getElementById('dashAssetCount').innerText = assetData.length + ' Items';

            document.getElementById('assetTable').innerHTML = assetFiltered.map(a => `
                <tr>
                    <td><img src="${a.image || 'https://via.placeholder.com/50'}" class="rounded border bg-white" style="width: 40px; height: 40px; object-fit: cover; cursor: zoom-in;" onclick="window.open(this.src)"></td>
                    <td><span class="fw-bold text-primary small">${a.code}</span></td>
                    <td><span class="small text-muted">${a.serial || '-'}</span></td>
                    <td><span class="badge bg-white text-dark border">${a.branch}</span></td>
                    <td>${a.name}</td>
                    <td>${a.holder}</td>
                    <td>${(a.value || 0).toLocaleString()}</td>
                    <td><span class="badge ${a.status === 'Repair' ? 'bg-danger' : 'bg-success'}">${a.status}</span></td>
                    <td class="small text-muted text-truncate" style="max-width: 150px;">${a.note}</td>
                    <td>
                        <button class="btn btn-sm btn-light border" onclick="openEditModal('${a.code}')"><i class="fas fa-wrench text-warning"></i></button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-light border ms-1" onclick="deleteAsset('${a.code}')"><i class="fas fa-trash text-danger"></i></button>` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function filterAsset(t) { assetFiltered = t === 'all' ? assetData : assetData.filter(a => a.type === t); renderAssets(); }
        function searchAssets(q) { assetFiltered = assetData.filter(a => Object.values(a).some(v => String(v).toLowerCase().includes(q.toLowerCase()))); renderAssets(); }

        function saveNewAsset() {
            // Get Elements
            const elCode = document.getElementById('newAssetCode');
            const elName = document.getElementById('newAssetName');
            const elBranch = document.getElementById('newAssetBranch');
            const elType = document.getElementById('newAssetType');
            const elVal = document.getElementById('newAssetValue');
            const elVendor = document.getElementById('newAssetVendor');
            const elSerial = document.getElementById('newAssetSerial');

            // Reset Logic
            [elCode, elName, elBranch, elType, elVal, elVendor, elSerial].forEach(el => el.classList.remove('is-invalid'));
            let hasError = false;

            // Strict Validation ("‡∫à‡∫á‡∫ª‡∫Å‡∫≠‡∫Å‡ªÉ‡∫´‡∫Ñ‡ªâ‡∫ö" - Fill Complete)
            if (!elCode.value) { elCode.classList.add('is-invalid'); hasError = true; }
            if (!elName.value) { elName.classList.add('is-invalid'); hasError = true; }
            if (!elBranch.value) { elBranch.classList.add('is-invalid'); hasError = true; }
            if (!elType.value) { elType.classList.add('is-invalid'); hasError = true; }
            if (!elVal.value || elVal.value == 0) { elVal.classList.add('is-invalid'); hasError = true; }
            // Optional but requested "Complete":
            // if (!elVendor.value) { elVendor.classList.add('is-invalid'); hasError = true; }
            // if (!elSerial.value) { elSerial.classList.add('is-invalid'); hasError = true; }

            if (hasError) {
                return alert('‚ö†Ô∏è ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫ï‡∫∑‡ªà‡∫°‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫ª‡∫ö‡∫ñ‡ªâ‡∫ß‡∫ô (Please fill in all information completely)!');
            }

            const file = document.getElementById('newAssetImage').files[0];
            const save = (img) => {
                const item = {
                    code: elCode.value,
                    name: elName.value,
                    branch: elBranch.value,
                    folder: document.getElementById('newAssetFolder').value || 'Uncategorized',
                    type: elType.value,
                    value: parseFloat(elVal.value) || 0,
                    holder: document.getElementById('newAssetHolder').value || '-',
                    serial: elSerial.value || '-',
                    vendor: elVendor.value || '-',
                    purchaseDate: document.getElementById('newAssetPurchaseDate').value || '',
                    warrantyDate: document.getElementById('newAssetWarrantyDate').value || '',
                    status: 'Active',
                    note: '-',
                    image: img
                };

                assetData.push(item);
                assetFiltered = assetData;
                renderAssets();

                // Close Modal
                bootstrap.Modal.getInstance(document.getElementById('addAssetModal')).hide();

                // Sync to Backend
                if (typeof google !== 'undefined' && google.script) {
                    google.script.run.withSuccessHandler(() => {
                        // Success Feedback
                        alert('‚úÖ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î (Saved Successfully)!');
                    }).saveAsset(item);
                } else {
                    saveToLocalBackup();
                    alert('‚ö†Ô∏è Offline Mode: Saved locally.');
                }
            };
            if (file) compressImage(file, save); else save('');
        }

        function openEditModal(c) {
            const i = assetData.find(a => a.code === c);
            if (!i) return;
            document.getElementById('editAssetCodeHidden').value = c;
            document.getElementById('editAssetName').value = i.name;
            document.getElementById('editAssetFolder').value = i.folder;
            document.getElementById('editAssetHolder').value = i.holder;
            document.getElementById('editAssetBranch').value = i.branch;
            document.getElementById('editAssetStatus').value = i.status;
            document.getElementById('editAssetNote').value = i.note;

            const img = document.getElementById('editAssetPreview');
            const ph = document.getElementById('editAssetPlaceholder');
            if (i.image) { img.src = i.image; img.classList.remove('d-none'); ph.classList.add('d-none'); }
            else { img.classList.add('d-none'); ph.classList.remove('d-none'); }

            toggleRepairNote();
            new bootstrap.Modal(document.getElementById('editAssetModal')).show();
        }

        function toggleRepairNote() { document.getElementById('repairNoteDiv').classList.toggle('show', document.getElementById('editAssetStatus').value === 'Repair'); }

        function saveEditAsset() {
            const c = document.getElementById('editAssetCodeHidden').value;
            const i = assetData.find(a => a.code === c);
            if (i) {
                i.name = document.getElementById('editAssetName').value;
                i.branch = document.getElementById('editAssetBranch').value;
                i.folder = document.getElementById('editAssetFolder').value;
                i.holder = document.getElementById('editAssetHolder').value;
                i.status = document.getElementById('editAssetStatus').value;
                i.note = i.status === 'Repair' ? document.getElementById('editAssetNote').value : '-';

                const file = document.getElementById('editAssetImage').files[0];
                const update = (img) => {
                    if (img) i.image = img;
                    renderAssets();
                    bootstrap.Modal.getInstance(document.getElementById('editAssetModal')).hide();
                    if (typeof google !== 'undefined' && google.script) google.script.run.updateAsset(i); else saveToLocalBackup();
                };
                if (file) compressImage(file, update); else update(null);
            }
        }

        function deleteAsset(c) {
            if (confirm('Delete ' + c + '?')) {
                assetData = assetData.filter(a => a.code !== c); assetFiltered = assetData; renderAssets();
                if (typeof google !== 'undefined' && google.script) google.script.run.deleteAsset(c); else saveToLocalBackup();
            }
        }

        function printReport() { window.print(); }
        function saveToLocalBackup() { localStorage.setItem('bn_backup_v2', JSON.stringify(assetData)); }
        function loadFromLocalBackup() { const d = localStorage.getItem('bn_backup_v2'); if (d) assetData = JSON.parse(d); assetFiltered = assetData; renderAssets(); }
        function simulateQrAudit() { const c = prompt("Scan QR:"); if (c) alert(assetData.find(a => a.code === c) ? '‚úÖ Found' : '‚ùå Not Found'); }

    </script>
</body>

</html>